import{d as R,r as z,x as y,y as f,z as e,E as L,F as m,_ as U,k as P,G,A as b,H as S,o as E,I as N,J as M,K as J,T as H,B as x,L as V,M as K}from"#entry";import{u as q}from"./CySDVrLX.js";const Q={class:"file-upload"},X={class:"upload-content"},Y={class:"file-input-label"},Z=R({__name:"FileUpload",props:{onFilesSelected:{type:Function}},setup(s){const g=s,n=z(!1),h=c=>{const t=c.target;t.files&&g.onFilesSelected(Array.from(t.files))},p=c=>{c.preventDefault(),n.value=!1,c.dataTransfer?.files&&g.onFilesSelected(Array.from(c.dataTransfer.files))},r=c=>{c.preventDefault()},_=c=>{c.preventDefault(),n.value=!0},d=c=>{c.preventDefault();const t=c.currentTarget,a=c.relatedTarget;t&&a&&!t.contains(a)&&(n.value=!1)};return(c,t)=>(f(),y("div",Q,[e("div",{class:L(["upload-area",{"drag-over":m(n)}]),onDrop:p,onDragover:r,onDragenter:_,onDragleave:d},[e("div",X,[t[1]||(t[1]=e("div",{class:"upload-icon"}," ğŸ“· ",-1)),t[2]||(t[2]=e("h3",null,"Select files or drag & drop",-1)),t[3]||(t[3]=e("p",null,"Supports JPEG, PNG, WebP, and GIF image files",-1)),e("label",Y,[e("input",{type:"file",multiple:"",accept:"image/*",onChange:h,class:"file-input"},null,32),t[0]||(t[0]=e("span",{class:"file-input-button"},"Choose Files",-1))])])],34)]))}}),ee=Object.assign(U(Z,[["__scopeId","data-v-cdd30ea1"]]),{__name:"FileUpload"}),C=()=>{const s=z([]),g=t=>{Array.from(t).forEach(o=>{if(!o.type.startsWith("image/")){console.warn("Skipping non-image file:",o.name);return}const l=URL.createObjectURL(o),i={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:o.name,originalFile:o,originalSize:o.size,originalUrl:l,isProcessing:!1};s.value.push(i)})},n=t=>{const a=s.value.findIndex(o=>o.id===t);if(a>=0){const o=s.value[a];URL.revokeObjectURL(o.originalUrl),o.processedUrl&&URL.revokeObjectURL(o.processedUrl),s.value.splice(a,1)}},h=()=>{s.value.forEach(t=>{URL.revokeObjectURL(t.originalUrl),t.processedUrl&&URL.revokeObjectURL(t.processedUrl)}),s.value=[]},p=t=>{if(t===0)return"0 B";const a=1024,o=["B","KB","MB","GB"],l=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,l)).toFixed(2))+" "+o[l]},r=(t,a)=>{if(!a)return"-";const o=(t-a)/t*100;return o>0?`${o.toFixed(1)}%`:"0%"},_=P(()=>{const t=s.value.length,a=s.value.filter(v=>v.isProcessing).length,o=s.value.filter(v=>v.processedData).length,l=s.value.filter(v=>v.error).length,i=s.value.reduce((v,$)=>v+$.originalSize,0),w=s.value.filter(v=>v.processedSize).reduce((v,$)=>v+($.processedSize||0),0);return{total:t,processing:a,completed:o,errors:l,originalTotalSize:i,processedTotalSize:w,totalCompressionRatio:r(i,w)}}),d=t=>{t.preventDefault(),t.dataTransfer?.files&&g(t.dataTransfer.files)},c=t=>{t.preventDefault()};return{images:G(s),addFiles:g,removeImage:n,clearImages:h,formatFileSize:p,getCompressionRatio:r,getStats:_,handleDrop:d,handleDragOver:c}},se={class:"image-card"},te={key:0,class:"loading-overlay"},oe={key:1,class:"error-overlay"},ae={class:"error-text"},ne=["src","alt"],ie={class:"card-content"},re=["title"],le={class:"image-info"},ce={class:"size-info"},de={class:"original-size"},me={key:0,class:"processed-size"},ue={key:0,class:"compression-info"},ge=R({__name:"ImageCard",props:{image:{}},emits:["thumbnail-click","remove"],setup(s,{emit:g}){const n=s,{formatFileSize:h,getCompressionRatio:p}=C(),r=t=>h(t),_=P(()=>p(n.image.originalSize,n.image.processedSize)),d=P(()=>n.image.isProcessing?"processing":n.image.error?"error":n.image.processedData?"completed":"pending"),c=P(()=>n.image.isProcessing?"Processing...":n.image.error?"Error":n.image.processedData?"Done":"Pending");return(t,a)=>(f(),y("div",se,[e("div",{class:"image-container",onClick:a[0]||(a[0]=o=>t.$emit("thumbnail-click"))},[s.image.isProcessing?(f(),y("div",te,[...a[2]||(a[2]=[e("div",{class:"spinner"},null,-1)])])):s.image.error?(f(),y("div",oe,[a[3]||(a[3]=e("div",{class:"error-icon"},"âš ï¸",-1)),e("div",ae,b(s.image.error),1)])):(f(),y("img",{key:2,src:s.image.processedUrl||s.image.originalUrl,alt:s.image.name,class:"image-preview",loading:"lazy"},null,8,ne)),e("div",{class:L(["status-indicator",m(d)])},b(m(c)),3)]),e("div",ie,[e("h4",{class:"image-name",title:s.image.name},b(s.image.name),9,re),e("div",le,[e("div",ce,[e("span",de," Original: "+b(r(s.image.originalSize)),1),s.image.processedSize?(f(),y("span",me," â†’ "+b(r(s.image.processedSize)),1)):S("",!0)]),s.image.processedSize?(f(),y("div",ue," Compression Ratio: "+b(m(_)),1)):S("",!0)]),e("button",{onClick:a[1]||(a[1]=o=>t.$emit("remove")),class:"remove-button",title:"Remove image"}," âœ• ")])]))}}),pe=Object.assign(U(ge,[["__scopeId","data-v-8beeb091"]]),{__name:"ImageCard"}),fe={class:"modal-header"},ve={class:"modal-body"},ye={class:"image-wrapper"},he=["src","alt"],_e={class:"modal-footer"},be={class:"image-details"},we={class:"detail-item"},ke={class:"value"},Se={key:0,class:"detail-item"},ze={class:"value"},Pe={key:1,class:"detail-item"},$e={class:"value"},Ie={class:"detail-item"},Re={class:"value"},Ue=R({__name:"ImageModal",props:{show:{type:Boolean},image:{}},emits:["close"],setup(s,{emit:g}){const n=s,h=g,{formatFileSize:p,getCompressionRatio:r}=C(),_=a=>p(a),d=P(()=>n.image?r(n.image.originalSize,n.image.processedSize):"-"),c=a=>({"image/jpeg":"JPEG","image/png":"PNG","image/gif":"GIF","image/webp":"WebP","image/bmp":"BMP","image/svg+xml":"SVG"})[a]||"Unknown",t=()=>{h("close")};return E(()=>{const a=o=>{o.key==="Escape"&&n.show&&h("close")};document.addEventListener("keydown",a),N(()=>{document.removeEventListener("keydown",a)})}),(a,o)=>(f(),M(H,{to:"body"},[s.show&&s.image?(f(),y("div",{key:0,class:"modal-overlay",onClick:t},[e("div",{class:"modal-content",onClick:o[1]||(o[1]=J(()=>{},["stop"]))},[e("div",fe,[e("h3",null,b(s.image.name),1),e("button",{onClick:o[0]||(o[0]=l=>a.$emit("close")),class:"close-button"}," âœ• ")]),e("div",ve,[e("div",ye,[e("img",{src:s.image.processedUrl||s.image.originalUrl,alt:s.image.name,class:"full-image"},null,8,he)])]),e("div",_e,[e("div",be,[e("div",we,[o[2]||(o[2]=e("span",{class:"label"},"Original Size:",-1)),e("span",ke,b(_(s.image.originalSize)),1)]),s.image.processedSize?(f(),y("div",Se,[o[3]||(o[3]=e("span",{class:"label"},"Compressed:",-1)),e("span",ze,b(_(s.image.processedSize)),1)])):S("",!0),s.image.processedSize?(f(),y("div",Pe,[o[4]||(o[4]=e("span",{class:"label"},"Compression Ratio:",-1)),e("span",$e,b(m(d)),1)])):S("",!0),e("div",Ie,[o[5]||(o[5]=e("span",{class:"label"},"Format:",-1)),e("span",Re,b(s.image.processedData?"WebP":c(s.image.originalFile.type)),1)])])])])])):S("",!0)]))}}),Ce=Object.assign(U(Ue,[["__scopeId","data-v-afb56ead"]]),{__name:"ImageModal"}),D=s=>new Promise(g=>{s.addEventListener("message",()=>{g(s)},{once:!0})}),Fe=(s,g,...n)=>new Promise((h,p)=>{const r=async _=>{const{data:d}=_;switch(d.type){case"callback":const c=n[d.payload.index](d.payload.value);s.postMessage({type:"callback_result",payload:{id:d.payload.id,result:await c}});break;case"result":s.removeEventListener("message",r),h(d.payload);break;case"error":s.removeEventListener("message",r),p(d.payload);break}};s.addEventListener("message",r),s.postMessage({type:"function",payload:{name:g,value:n.map(_=>typeof _!="function"&&_),callback:n.map(_=>typeof _=="function")}})}),xe=(s,g=4)=>{let n=Array(g).fill(void 0).map(()=>({}));const h=[];let p=!1;const r=async()=>{for(;;){const l=n.find(({resultResolver:i})=>!i);if(l){if(l.resultResolver=Promise.withResolvers(),!l.worker){const i=s(),w=i instanceof Worker?i:new Worker(i);l.worker=await D(w)}return l}await Promise.race(n.map(({resultResolver:i})=>i?.promise))}};return{execute:async(l,...i)=>{const w=await r(),{resultResolver:v}=w;if(!v)throw new Error("Unexpected error");return Fe(w.worker,l,...i).then(v.resolve).catch(v.reject).finally(()=>{w.resultResolver=void 0}),v.promise},waitAll:async()=>{for(;n.find(({resultResolver:l})=>l);)await Promise.all(n.flatMap(({resultResolver:l})=>l?[l.promise]:[]))},waitReady:async(l=1)=>{const i=Promise.withResolvers();return h.push(i),(async()=>{if(!p){p=!0;do{const w=n.flatMap(({resultResolver:v})=>v?[v.promise]:[]);n.length===w.length&&await Promise.race(w),h.shift()?.resolve(),l?await new Promise(v=>setTimeout(v,l)):await Promise.resolve()}while(h.length);p=!1}})(),i.promise},close:()=>{for(const{worker:l}of n)l?.terminate()},setLimit:l=>{n.forEach(i=>i.worker?.terminate()),n=Array(l).fill(void 0).map(()=>({}))},launchWorker:async()=>Promise.all(n.map(async l=>{if(!l.worker){const i=s(),w=i instanceof Worker?i:new Worker(i);l.worker=await D(w)}}))}},{execute:De,setLimit:Le,launchWorker:Ee}=xe(()=>new Worker(new URL(""+new URL("vite-web-worker-B_NuJUJd.js",import.meta.url).href,import.meta.url)),5),Me=async s=>De("optimizeImageExt",s),We=()=>{const s=async()=>{},g=async h=>{try{const p=await h.arrayBuffer(),r=await Me({image:p,format:"webp",quality:80,width:1536,height:1536});if(!r||!r.data)throw new Error("Image processing failed: No data returned");return{success:!0,data:r.data,originalSize:p.byteLength,processedSize:r.data.length}}catch(p){return console.error("Image processing failed:",p),{success:!1,originalSize:h.size,error:p instanceof Error?p.message:"Unknown error"}}};return{initializeProcessor:s,processImage:g,processImages:async h=>{if(typeof window>"u")return;const p=h.filter(r=>!r.isProcessing&&!r.processedData).map(async(r,_)=>{r.isProcessing=!0;try{const d=await g(r.originalFile);if(d.success&&d.data){console.log("result.data",d.data);const c=new Blob([new Uint8Array(d.data)],{type:"image/webp"}),t=URL.createObjectURL(c);Object.assign(r,{processedData:d.data,processedSize:d.processedSize,processedUrl:t,isProcessing:!1,error:void 0})}else Object.assign(r,{isProcessing:!1,error:d.error||"Processing failed"})}catch(d){Object.assign(r,{isProcessing:!1,error:d instanceof Error?d.message:"Processing failed"})}});await Promise.all(p)}}},Ae={class:"demo-page"},Te={class:"main-content"},Oe={class:"upload-section"},Be={key:0,class:"stats-section"},je={class:"stats-grid"},Ge={class:"stat-item"},Ne={class:"stat-number"},Je={class:"stat-item"},He={class:"stat-number"},Ve={class:"stat-item"},Ke={class:"stat-number"},qe={class:"stat-item"},Qe={class:"stat-number"},Xe={key:0,class:"compression-stats"},Ye={class:"compression-item"},Ze={class:"compression-item"},es={class:"compression-item highlight"},ss={key:1,class:"actions-section"},ts=["disabled"],os={key:0},as={key:1},ns={key:2},is={key:2,class:"images-section"},rs={class:"images-grid"},ls={key:3,class:"empty-state"},cs={class:"info-section"},ds={class:"info-box"},ms={class:"tech-details"},us={key:0},gs={key:1},ps=R({__name:"index",setup(s){Le(8),Ee();const{images:g,addFiles:n,removeImage:h,clearImages:p,formatFileSize:r,getStats:_}=C(),{processImages:d}=We(),c=z(!1),t=z(null),a=z(!1),o=z(!1),l=z(8),i=P(()=>_.value),w=P(()=>g.value.length>0&&g.value.every(k=>k.processedData||k.error)),v=k=>{n(k)},$=async()=>{if(!(a.value||w.value)){a.value=!0;try{await d(g.value)}catch(k){console.error("Processing failed:",k)}finally{a.value=!1}}},W=()=>{p(),F()},A=k=>{t.value=k,c.value=!0},F=()=>{c.value=!1,t.value=null};return E(async()=>{o.value=!0}),q({title:"WASM Image Reducer Demo - Nuxt 3",meta:[{name:"description",content:"WebAssembly powered image compression demo built with Nuxt 3 and TypeScript"}]}),(k,u)=>{const T=ee,O=pe,B=Ce;return f(),y("div",Ae,[u[12]||(u[12]=e("header",{class:"page-header"},[e("h1",null,"WASM Image Reducer Demo"),e("p",null,"High-performance image compression demo powered by WebAssembly (Nuxt 3 + TypeScript)"),e("p",{class:"resize-note"},"Note: Images are resized so that the longer side is at most 1536px before compression.")],-1)),e("main",Te,[e("section",Oe,[x(T,{onFilesSelected:v})]),m(i).total>0?(f(),y("section",Be,[e("div",je,[e("div",Ge,[e("div",Ne,b(m(i).total),1),u[0]||(u[0]=e("div",{class:"stat-label"},"Total Files",-1))]),e("div",Je,[e("div",He,b(m(i).processing),1),u[1]||(u[1]=e("div",{class:"stat-label"},"Processing",-1))]),e("div",Ve,[e("div",Ke,b(m(i).completed),1),u[2]||(u[2]=e("div",{class:"stat-label"},"Completed",-1))]),e("div",qe,[e("div",Qe,b(m(i).errors),1),u[3]||(u[3]=e("div",{class:"stat-label"},"Errors",-1))])]),m(i).completed>0?(f(),y("div",Xe,[e("div",Ye,[u[4]||(u[4]=e("span",null,"Original Size:",-1)),e("span",null,b(m(r)(m(i).originalTotalSize)),1)]),e("div",Ze,[u[5]||(u[5]=e("span",null,"Compressed:",-1)),e("span",null,b(m(r)(m(i).processedTotalSize)),1)]),e("div",es,[u[6]||(u[6]=e("span",null,"Reduction:",-1)),e("span",null,b(m(i).totalCompressionRatio),1)])])):S("",!0)])):S("",!0),m(g).length>0?(f(),y("section",ss,[e("button",{onClick:$,disabled:m(a)||m(w),class:"action-button primary"},[m(a)?(f(),y("span",os,"Processing...")):m(w)?(f(),y("span",as,"All Done")):(f(),y("span",ns,"Compress All (WebP, 80%, 1536x1536 - content)"))],8,ts),e("button",{onClick:W,class:"action-button secondary"}," Clear ")])):S("",!0),m(g).length>0?(f(),y("section",is,[e("div",rs,[(f(!0),y(V,null,K(m(g),I=>(f(),M(O,{key:I.id,image:I,onThumbnailClick:j=>A(I),onRemove:j=>m(h)(I.id)},null,8,["image","onThumbnailClick","onRemove"]))),128))])])):(f(),y("section",ls,[...u[7]||(u[7]=[e("div",{class:"empty-icon"},"ğŸ–¼ï¸",-1),e("h3",null,"Upload images to get started",-1),e("p",null,"Supports JPEG, PNG, WebP, and GIF formats",-1)])])),e("section",cs,[e("div",ds,[u[11]||(u[11]=e("h4",null,"ğŸ”§ Technical Info",-1)),e("div",ms,[m(o)?(f(),y("div",us,[u[8]||(u[8]=e("p",null,"âœ… Running on client side",-1)),e("p",null,"ğŸ”§ Web Workers: "+b(m(l)),1),u[9]||(u[9]=e("p",null,"ğŸ“¦ WASM: High-speed processing via WebAssembly",-1))])):(f(),y("div",gs,[...u[10]||(u[10]=[e("p",null,"ğŸ”„ SSR mode - waiting for client hydration",-1)])]))])])])]),x(B,{show:m(c),image:m(t),onClose:F},null,8,["show","image"])])}}}),ys=U(ps,[["__scopeId","data-v-9570263e"]]);export{ys as default};
